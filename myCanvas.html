<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>My Draw Setup</title>
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <canvas id="myCanvas" width="400" height="300"></canvas>
     <canvas id="myCanvas_2" width="400" height="300"></canvas>
      
      <p><label id = "speed-amount">0</label><input type="range" id="slicer-speed" min = "1" max = "100" step = "2" value="0"></p>
      
      <p><label id = "range-amount">0</label> <input type="range" id="slicer-range" min = "1" max = "100" step = "2" value="30"></p>
      
      <p><label id = "size-amount">0</label> <input type="range" id="slicer-size" min = "1" max = "100" step = "2" value="0"></p>
      
<!--      <script src="js/utils.js"></script>-->
      <script src="js/draw_shape.js"></script>
      <script src="js/control.js"></script>
    <script>
        
     window.onload = function () {    
        //initilize my canvas
       var canvas = document.getElementById('myCanvas');
       var context = canvas.getContext('2d');
       
        //create an image on a canvas, set up position
        ////render my ball circles
        
        //start position of ball   
          initial_pos_x = 100
          initial_pos_y = 100
        
        var myBall = Shape.Ball({pos_x:initial_pos_x, pos_y:initial_pos_y})

              
          range = 60,
          speed = 0.05;
          centerScale = .3     
          
//          myBall.x = initial_pos_x;
//          myBall.y = initial_pos_y;
//       
          
          //mouse 
          var my_mouse = Control.Mouse(canvas)
          console.log('mouse:',my_mouse)
//          console.log('pos:',my_mouse.getMousePos())
          
        
        //main animation  
          
       window.requestAnimationFrame(animation)  

        function animation () {
   
          context.clearRect(0,0,canvas.width,canvas.height);
          
          simulate_path(myBall,context);
          
         current_position = myBall.getPosition()
         current_position = motionUpdate(current_position.x,current_position.y)
         
        
         myBall.drawCircle(context)
    
         if (current_position.x > canvas.width || current_position.y > canvas.height){
            myBall.setPosition(1,1)
         }else {
            myBall.setPosition(current_position.x,current_position.y)
         }
         
          window.requestAnimationFrame(animation)
    };  

//mouse event    
         
         mouse = Control.captureMouse(canvas)
         
    canvas.addEventListener('mousedown', function (event) {
        
        if (containsPoint(myBall.getBounds(), mouse.x, mouse.y)) {
          canvas.addEventListener('mouseup', onMouseUp, false);
          canvas.addEventListener('mousemove', onMouseMove, false);
        }
      }, false);
      
      function onMouseUp () {
        canvas.removeEventListener('mouseup', onMouseUp, false);
        canvas.removeEventListener('mousemove', onMouseMove, false);
      }
      
      function onMouseMove () {
        myBall.setPosition(mouse.x,mouse.y)
      }

      function containsPoint (rect, x, y) {
  return !(x < rect.x ||
           x > rect.x + rect.width ||
           y < rect.y ||
           y > rect.y + rect.height);
      };     
         
    
        
 } //end windows onload
    
//helper function     
     
function simulate_path(target,context){
      var feq = 800
      
      start_position = target.getPosition()
      
      next_position = motionUpdate(start_position.x,start_position.y)
     
      for (var i = 0; i<feq; i+=1){
        
        next_position = motionUpdate(next_position.x,next_position.y)
        
        var copy_ball = Shape.Ball({pos_x:next_position.x,pos_y:next_position.y,scale_x:.05,scale_y:.05,})
        copy_ball.drawCircle(context)
      }

}//end draw path    
        
function motionUpdate(x,y){
    var position = {}
    
  var slicer_speed = document.getElementById('slicer-speed')
  var slicer_range = document.getElementById('slicer-range')
  var slicer_size  = document.getElementById('slicer-size')
            
  var speed_amount = document.getElementById("speed-amount")
  var range_amount = document.getElementById("range-amount")
  var size_amount  = document.getElementById("size-amount")

        speed_amount.innerHTML = "Speed: " + slicer_speed.value
        range_amount.innerHTML = "Range: " + slicer_range.value
        size_amount.innerHTML  = "Size: "  + slicer_size.value
  period = Math.PI*.04
    position.x = x + .5*slicer_speed.value
    position.y = Math.cos(x*period)*slicer_range.value + 300/2
        
    return position
    

}    
        
    
    </script>
        

  </body>
</html>